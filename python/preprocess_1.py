''' set up '''
# Common imports
import pandas as pd
import matplotlib
import matplotlib.pyplot as plt
import numpy as np
import os
from skimage.transform import resize
from scipy import io
import pickle
%matplotlib inline

'''Load Data'''
path = "G:\\Malware\\train" # directory of file

items = os.listdir(path) # get all files in the directory
files = [] # only byte files
for names in items:
    if names.endswith(".bytes"):
        files.append(names)
        
'''Data Preprocessing'''
filename = []
all_images = []

for i in range(40,41):    
    file_id = open('G:\\Malware\\train\\%s' % files[i],'r') 
    filename.append(files[i])
    print(i)
    print(files[i])
       
    text_data = pd.read_csv(file_id, sep='\s+', header=None, low_memory=False) # read the .bytes file
    text_data = text_data.dropna() # removing rows with NaN   
    file_id.close()
    
    column_numbers = [x for x in range(text_data.shape[1])]  # list of columns' integer indices
    column_numbers .remove(0) # removing column integer index 0
    text_data_2 = text_data.iloc[:, column_numbers] # return all columns except the 0th column

    
    decimal_data = np.zeros((text_data_2.shape[0],text_data_2.shape[1]),float)#create a variable to store preprcoessedtext data
    text_data_2 = text_data_2.replace('??', -1) # replace all '??' with '-1' in text data
    text_data_2 = text_data_2.apply(lambda x: x.astype(bytes).map(lambda x: int(x, base=16))) # convert hex to dec

    decimal_data = text_data_2 
    decimal_data = decimal_data.values # df -> nparray

    dec = resize(decimal_data,[256,16],anti_aliasing=True) # resize to graph format
    fig, ax = plt.subplots(figsize=(6, 6)) # draw the graph
    ax.imshow(dec, extent=[0,1,0,1],cmap='gray') # gray scale
    all_images.append(dec.reshape([1,4096])) # reshape and store

npa = np.asarray(all_images) # store as np array

# save file as .mat for both matlab and python use
io.savemat('C:/Users/wuh00/OneDrive/Desktop/SPRING_2019/ECE595_ML/Project_1/all_train_files.mat', [npa,filename])